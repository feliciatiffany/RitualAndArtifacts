<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevator Bet - Stats</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .stats-page { padding: 40px; text-align: center; }
        .stats-grid { display: grid; gap: 20px; margin: 40px 0; }
        .stat-card { background: rgba(255,255,255,0.9); padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .stat-value { font-size: 64px; color: #66c2a4; font-weight: bold; }
        .stat-label { font-size: 24px; color: #666; margin-top: 10px; }
        .back-link { display: inline-block; margin-top: 30px; color: #66c2a4; font-size: 24px; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="stats-page">
        <h1>üìä Bet Statistics</h1>
        <p class="subtitle">Elevator Bet Game - Rituals & Artifacts</p>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-bets">0</div>
                <div class="stat-label">Total Bets</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="win-rate">0</div>
                <div class="stat-label">Win Rate %</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="wins">0</div>
                <div class="stat-label">Wins</div>
            </div>
        </div>
        
        <a href="index.html" class="back-link">‚Üê Back to Game</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // ÈúÄ‰∏é app.js ‰∏≠ÁöÑÈÖçÁΩÆ‰∏ÄËá¥
        const firebaseConfig = {
            apiKey: "AIzaSyCpSpPI2Ak6Ts4uMJ3tBqPPLziGDKssZGE",
            authDomain: "elevator-game-8a4bb.firebaseapp.com",
            databaseURL: "https://elevator-game-8a4bb-default-rtdb.firebaseio.com",
            projectId: "elevator-game-8a4bb",
            storageBucket: "elevator-game-8a4bb.firebasestorage.app",
            messagingSenderId: "258702222821",
            appId: "1:258702222821:web:9000b3f408dc56bfb73b0c",
            measurementId: "G-BJPXKL7YPB"
        };

        const STORAGE_KEY = 'elevator_bet_history';

        function getLocalBets() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                return [];
            }
        }

        function updateUI(total, wins, winRate) {
            const totalEl = document.getElementById('total-bets');
            const rateEl = document.getElementById('win-rate');
            const winsEl = document.getElementById('wins');
            if (totalEl) totalEl.textContent = total;
            if (rateEl) rateEl.textContent = winRate;
            if (winsEl) winsEl.textContent = wins;
        }

        let db = null;
        try {
            const hasValidConfig = firebaseConfig.apiKey && !firebaseConfig.apiKey.includes('‰Ω†ÁöÑ');
            if (hasValidConfig) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                loadStats();
            } else {
                loadFromLocalStorage();
            }
        } catch (e) {
            console.warn('Firebase init failed:', e.message);
            loadFromLocalStorage();
        }

        function loadFromLocalStorage() {
            const bets = getLocalBets();
            const total = bets.length;
            const wins = bets.filter(b => b.result === 'win').length;
            const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
            updateUI(total, wins, winRate);
        }

        async function loadStats() {
            if (db) {
                try {
                    const snapshot = await db.collection('bets').get();
                    const total = snapshot.size;
                    let wins = 0;
                    snapshot.forEach(doc => {
                        if (doc.data().result === 'win') wins++;
                    });
                    const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
                    updateUI(total, wins, winRate);
                    return;
                } catch (err) {
                    console.warn('Firebase load failed:', err.message);
                }
            }
            loadFromLocalStorage();
        }
    </script>
</body>
</html>
